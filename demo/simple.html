<!DOCTYPE html>
<html>
<head>
    <title>simpe page</title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <link href="../bower_components/tinyui/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="../bower_components/tinyui/dist/css/tiny.css" rel="stylesheet" />
    <link href="../bower_components/jstree-bootstrap-theme/dist/themes/proton/style.min.css" rel="stylesheet" />
    <link href="../bower_components/smalot-bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <link href="../bower_components/bs-datetimepicker/build/css/bootstrap-datetimepicker.css" rel="stylesheet" />
</head>

<body>
    <hr />
    <form class="form-horizontal" method="post" role="form">
        <div class="form-group">
            <label class="col-md-2 control-label" for="Email">电子邮件</label>
            <div class="col-md-10">
                <div class="input-group">
                    <span class="input-group-addon">@</span>
                    <input class="form-control" data-val="true" data-val-email="电子邮件 字段不是有效的电子邮件地址。" data-val-required="电子邮件 字段是必需的。" id="Email" name="Email" type="text" value="" />
                </div>
                <span class="field-validation-valid text-danger" data-valmsg-for="Email" data-valmsg-replace="true"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="Password">密码</label>
            <div class="col-md-10">
                <input class="form-control" data-val="true" data-val-required="密码 字段是必需的。" id="Password" name="Password" type="password" />
                <span class="field-validation-valid text-danger" data-valmsg-for="Password" data-valmsg-replace="true"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-2 control-label">日期</label>
            <div class="col-xs-10">
                <input class="form-control" data-val="true" data-val-required="日期字段是必需的。" id="date" name="date" type="text" />
                <span class="field-validation-valid text-danger" data-valmsg-for="date" data-valmsg-replace="true"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-2 control-label">自动完成</label>
            <div class="col-xs-10">
                <input class="typeahead form-control" type="text" placeholder="States of USA">
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <div class="checkbox">
                    <label for="RememberMe">
                        <input data-val="true" required data-val-required="记住我? 字段是必需的。"
                               id="RememberMe" name="RememberMe" type="checkbox" value="true" />
                        记住我?
                    </label>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="登录" class="btn btn-default" />
            </div>
        </div>
    </form>

    <form class="form-horizontal" style="width:900px;margin:0 auto;" data-ver-role="hello-veronica-ui">
        <div class="form-group">
            <label class="col-sm-2 control-label">Email</label>
            <div class="col-sm-10">
                <p class="form-control-static">email@example.com</p>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Email</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" name="email" data-inputmask="'alias': 'email'">
            </div>
        </div>
        <div class="form-group">
            <label for="inputPassword" class="col-sm-2 control-label">Password</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" name="password" placeholder="Password">
            </div>
        </div>
        <div class="form-group">
            <label for="inputPassword" class="col-sm-2 control-label">Date</label>
            <div class="col-sm-10">
                <input type="text" readonly class="form-control" name="date" id="datetimepicker" placeholder="Date">
            </div>
        </div>
        <div class="form-group">
            <table class="table" data-form-list="table">
                <caption>Optional table caption.</caption>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Username</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>@mdo</td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>Jacob</td>
                        <td>Thornton</td>
                        <td>@fat</td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td>Larry</td>
                        <td>the Bird</td>
                        <td>@twitter</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="form-group">
            <button class="btn btn-default" data-action="test">测试 Notify</button>
            <button type="submit" class="btn btn-default" data-action="fetch">获取数据</button>
        </div>
        <hr />
        <div id="jstree-proton-1" class="proton-demo">
            <ul>
                <li data-jstree='{ "opened" : true }'>
                    Node1
                    <ul>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            <a href="#">Node1</a>
                        </li>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            Node1
                        </li>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            Node1
                        </li>
                    </ul>
                </li>
                <li data-jstree='{ "opened" : true }'>
                    Node1
                    <ul>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            <a href="#">Node1</a>
                        </li>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            Node1
                        </li>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            Node1
                        </li>
                    </ul>
                </li>
                <li data-jstree='{ "opened" : true }'>
                    Node1
                    <ul>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            <a href="#">Node1</a>
                        </li>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            Node1
                        </li>
                        <li data-jstree='{ "icon" : "fa fa-arrow-circle-right" }'>
                            Node1
                        </li>
                    </ul>
                </li>
            </ul>
        </div>

        <div data-role="datatable" class="datatable" data-bind="source: data"
             data-header="tpl_project_main_list_header"
             data-template="tpl_project_main_list_item"></div>

        <div data-role="datat" class="list" data-bind="source: data"
             data-header="tpl_project_main_list_header"
             data-template="tpl_project_main_list_item"></div>
    </form>
    <script type="text/template" id="tpl_item">
        <div>#= value #</div>
        <ul>
            # for(var i = 0, len = items.length; i < len; i ++){ #
            <li>#= items[i].name #</li>
            # } #
        </ul>

    </script>
    <script type="text/template" id="tpl_project_main_list_header">
        <tr>
            <th></th>
            <th>名称</th>
        </tr>
    </script>
    <script type="text/template" id="tpl_project_main_list_item">
        <tr>
            <td colspan="2">#= value #</td>
        </tr>
        # for(var i = 0, len = items.length; i < len; i ++){ #
        <tr class="k-master-row">
            <td class="k-hierarchy-cell">
                <i class="glyphicon glyphicon-circle-arrow-right"></i>
            </td>
            <td>#= items[i].name #</td>
        </tr>
        # } #
    </script>
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../bower_components/underscore/underscore-min.js"></script>
    <script src="../bower_components/veronica/dist/veronica.js"></script>
    <script src="../dist/veronica-ui.js"></script>
    <script src="../bower_components/jstree/dist/jstree.min.js"></script>

    <script>
        // 创建 app
        var app = veronica.createApp({
            extensions: [window.veronicaui]
        });

        var ListView = kendo.ui.ListView;
        var CHANGE = "change",
        CANCEL = "cancel",
        DATABOUND = "dataBound",
        DATABINDING = "dataBinding",
        Widget = kendo.ui.Widget,
        keys = kendo.keys,
        FOCUSSELECTOR = ">*",
        PROGRESS = "progress",
        ERROR = "error",
        FOCUSED = "k-state-focused",
        SELECTED = "k-state-selected",
        KEDITITEM = "k-edit-item",
        EDIT = "edit",
        REMOVE = "remove",
        SAVE = "save",
        CLICK = "click",
        NS = ".kendoListView",
        proxy = $.proxy,
        activeElement = kendo._activeElement;
        var DataT = ListView.extend({
            options: {
                name: 'DataT',
                header: null,
                widths: []
            },
            init: function (element, options) {
                var that = this;
                ListView.fn.init.call(that, element, options);

                this._bindEvents();
            },
            _bindEvents: function () {
                var el = this.element;
                var me = this;
                el.on('click', '.k-hierarchy-cell', function (e) {
                    var $target = $(e.currentTarget);
                    var $row = $target.closest('tr');
                    me.switchRow($row);
                });
            },
            switchRow: function ($row) {
                var detailRow = $row.next('.k-detail-row');
                var colSpan = $row.children('td').length;
                var collapseCls = 'fn-collapse';
                var expandCls = 'fn-expand';

                if (detailRow.length === 0) {
                    detailRow = $('<tr class="k-detail-row"><td colspan="' + colSpan + '"></td></tr>');
                    detailRow.insertAfter($row);
                    this.trigger('detailInit', {
                        detailCell: detailRow.children('td'),
                        data: $row.data()
                    })
                }
                if (!$row.hasClass(expandCls)) {
                    $row.next('.k-detail-row').show();
                    $row.removeClass(collapseCls).addClass(expandCls);
                } else {
                    $row.next('.k-detail-row').hide();
                    $row.addClass(collapseCls).removeClass(expandCls);
                }
            },
            _element: function () {
                ListView.fn._element.call(this);

                var element = this.element;

                var tableHtml = '<div class="datatable-header"><table class="table table-bordered no-margin"><colgroup></colgroup><thead></thead></table></div>' +
                    '<div class="datatable-content grow"><table class="table table-bordered no-margin"><colgroup></colgroup><tbody></tbody></table></div>';
                element.html(tableHtml);

                var headerHtml = $('#' + this.options.header).html();
                var len = $(headerHtml).children('th').length;
                element.find('.datatable-header thead').html(headerHtml);
                element.find('colgroup').html(this._colgroup(len));

                this.element = this.element.find('.datatable-content tbody');


            },
            // 计算 colgroup 的值
            _colgroup: function (len) {
                var widths = this.options.widths;
                var cols = '';
                for (var i = 0; i < len; i++) {
                    var $col = $('<col />');
                    var width = widths[i];
                    if (width == null) {
                        width = (100 / len) + "%";
                    }
                    $col.width(width);
                    cols += $col.prop('outerHTML');
                }
                return cols;
            },
            _templates: function () {
                ListView.fn._templates.call(this);

                //  this.groupTemplate = kendo.template(options.groupTemplate || "");
            }
        });

        kendo.ui.plugin(DataT);

        var i = 0;
        app.widget.register('hello-veronica-ui', function (options) {
            var app = options.sandbox.app;
            var View = app.view.define({
                defaults: {
                    autoAction: true
                },
                staticModel: function () {
                    return {
                        data: app.data.source({
                            data: [
                                { name: "Tea", category: "Beverages" },
                                { name: "Coffee", category: "Beverages" },
                                { name: "Ham", category: "Food" }
                            ],
                            // group by the "category" field
                            group: { field: "category" }
                        })
                    };
                },
                initAttr: function () {
                    this.model({}, false);
                },
                modelBound: function () {
                    var me = this;
                    var dt = this.instance('.datatable');
                    dt.bind('detailInit', function (e) {
                        var cell = e.detailCell;
                        var view = dt.dataSource.view();

                        $('<ul></ul>').kendoListView({
                            dataSource: [{ text: "1" }, { text: "2" }],
                            template: '<li>#= text #</li>'

                        }).appendTo(cell);
                    });
                },
                enhance: function () {

                    // jstree
                    this.$('#jstree-proton-1').jstree({
                        'plugins': ["wholerow"],
                        'core': {
                            'themes': {
                                'name': 'proton',
                                'responsive': false
                            }
                        }
                    });

                    //  datetimepicker
                    $('#date').datetimepicker({
                        locale: 'zh-CN'
                    });

                    // placeholder
                    this.$('[placeholder]').placeholder();

                    // inputmask
                    app.formUtil.enableInputMask(this.$el);
                },
                testHandler: function () {
                    app.notify.warn('HAHA!!' + (i++));
                    app.notify.confirm("hhehhhh");
                    this.htmlWindow('hahahha');
                },
                fetchHandler: function () {
                    alert(JSON.stringify(app.formUtil.toJSON(this.$el)));
                }
            });
            var view = new View(options);
            view.show();
            return view;
        });
        app.launch().done(function () {
            // 解析界面
            app.parser.parse();
        });


    </script>
</body>

</html>
